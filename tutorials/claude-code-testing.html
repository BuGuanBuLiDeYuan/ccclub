<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Code æµ‹è¯•ç­–ç•¥ä¸å®è·µ - Claude Code Club</title>
    <meta name="description" content="æŒæ¡Claude Codeæµ‹è¯•çš„æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€E2Eæµ‹è¯•ç­‰">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/tutorial.css">
    <link rel="icon" type="image/svg+xml" href="../assets/logo-icon.svg">
</head>

<body>
    <header>
        <nav>
            <div class="nav-container">
                <div class="logo">
                    <a href="../index.html">
                        <img src="../assets/logo.svg" alt="Claude Code Club" class="logo-img">
                    </a>
                </div>
                <ul class="nav-links">
                    <li><a href="../index.html">é¦–é¡µ</a></li>
                    <li><a href="../tutorials/claude-basics.html">æ•™ç¨‹</a></li>
                    <li><a href="../examples/python-data-analysis.html">ç¤ºä¾‹</a></li>
                    <li><a href="../community.html">ç¤¾åŒº</a></li>
                    <li><a href="../about.html">å…³äº</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main class="tutorial-content">
        <div class="container">
            <article>
                <header class="tutorial-header">
                    <h1>Claude Code æµ‹è¯•ç­–ç•¥ä¸å®è·µ</h1>
                    <div class="tutorial-meta">
                        <span class="difficulty intermediate">ä¸­çº§</span>
                        <span class="duration">é˜…è¯»æ—¶é—´: 14åˆ†é’Ÿ</span>
                        <span class="category">æµ‹è¯•</span>
                    </div>
                    <p class="tutorial-description">
                        æ„å»ºå®Œæ•´çš„æµ‹è¯•ä½“ç³»ï¼Œä»å•å…ƒæµ‹è¯•åˆ°ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œç³»ç»Ÿç¨³å®šæ€§ã€‚
                    </p>
                </header>

                <div class="tutorial-body">
                    <section class="tutorial-section">
                        <h2>æµ‹è¯•é‡‘å­—å¡”</h2>
                        <div class="test-pyramid">
                            <div class="pyramid-level unit-tests">
                                <h3>ğŸ”¬ å•å…ƒæµ‹è¯• (70%)</h3>
                                <p>å¿«é€Ÿã€ç‹¬ç«‹ã€å¤§é‡</p>
                            </div>
                            <div class="pyramid-level integration-tests">
                                <h3>ğŸ”— é›†æˆæµ‹è¯• (20%)</h3>
                                <p>ç»„ä»¶é—´äº¤äº’æµ‹è¯•</p>
                            </div>
                            <div class="pyramid-level e2e-tests">
                                <h3>ğŸ­ ç«¯åˆ°ç«¯æµ‹è¯• (10%)</h3>
                                <p>å®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯•</p>
                            </div>
                        </div>
                    </section>

                    <section class="tutorial-section">
                        <h2>å•å…ƒæµ‹è¯•æœ€ä½³å®è·µ</h2>
                        <h3>æµ‹è¯•é©±åŠ¨å¼€å‘ (TDD)</h3>
                        <pre><code>// 1. å…ˆå†™æµ‹è¯•
describe('UserService', () => {
    describe('createUser', () => {
        it('should create user with valid data', async () => {
            const userData = {
                name: 'John Doe',
                email: 'john@example.com',
                password: 'securePassword123'
            };
            
            const user = await userService.createUser(userData);
            
            expect(user.id).toBeDefined();
            expect(user.name).toBe(userData.name);
            expect(user.email).toBe(userData.email);
            expect(user.password).not.toBe(userData.password); // åº”è¯¥è¢«åŠ å¯†
        });
        
        it('should throw error for invalid email', async () => {
            const userData = {
                name: 'John Doe',
                email: 'invalid-email',
                password: 'securePassword123'
            };
            
            await expect(userService.createUser(userData))
                .rejects.toThrow('Invalid email format');
        });
    });
});

// 2. å®ç°åŠŸèƒ½
class UserService {
    async createUser(userData) {
        // éªŒè¯é‚®ç®±æ ¼å¼
        if (!this.isValidEmail(userData.email)) {
            throw new Error('Invalid email format');
        }
        
        // åŠ å¯†å¯†ç 
        const hashedPassword = await bcrypt.hash(userData.password, 10);
        
        // åˆ›å»ºç”¨æˆ·
        const user = await this.userRepository.create({
            ...userData,
            password: hashedPassword,
            id: generateId(),
            createdAt: new Date()
        });
        
        return user;
    }
    
    isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }
}</code></pre>

                        <h3>Mockå’ŒStubçš„ä½¿ç”¨</h3>
                        <pre><code>// ä¾èµ–æ³¨å…¥å’ŒMock
describe('OrderService', () => {
    let orderService;
    let mockUserService;
    let mockPaymentService;
    let mockInventoryService;
    
    beforeEach(() => {
        mockUserService = {
            findById: jest.fn(),
            validateUser: jest.fn()
        };
        
        mockPaymentService = {
            processPayment: jest.fn()
        };
        
        mockInventoryService = {
            checkStock: jest.fn(),
            reserveItems: jest.fn()
        };
        
        orderService = new OrderService({
            userService: mockUserService,
            paymentService: mockPaymentService,
            inventoryService: mockInventoryService
        });
    });
    
    it('should create order successfully', async () => {
        // è®¾ç½®Mockè¿”å›å€¼
        mockUserService.findById.mockResolvedValue({
            id: 'user-1',
            name: 'John Doe',
            email: 'john@example.com'
        });
        
        mockInventoryService.checkStock.mockResolvedValue(true);
        mockInventoryService.reserveItems.mockResolvedValue(['item-1']);
        mockPaymentService.processPayment.mockResolvedValue({
            transactionId: 'tx-123',
            status: 'success'
        });
        
        const orderData = {
            userId: 'user-1',
            items: [{ id: 'item-1', quantity: 2 }],
            totalAmount: 100
        };
        
        const order = await orderService.createOrder(orderData);
        
        // éªŒè¯è°ƒç”¨
        expect(mockUserService.findById).toHaveBeenCalledWith('user-1');
        expect(mockInventoryService.checkStock).toHaveBeenCalledWith(orderData.items);
        expect(mockPaymentService.processPayment).toHaveBeenCalledWith({
            amount: 100,
            userId: 'user-1'
        });
        
        // éªŒè¯ç»“æœ
        expect(order.id).toBeDefined();
        expect(order.status).toBe('confirmed');
    });
});</code></pre>
                    </section>

                    <section class="tutorial-section">
                        <h2>é›†æˆæµ‹è¯•ç­–ç•¥</h2>
                        <h3>APIé›†æˆæµ‹è¯•</h3>
                        <pre><code>// APIé›†æˆæµ‹è¯•
describe('User API Integration', () => {
    let app;
    let testDb;
    
    beforeAll(async () => {
        // è®¾ç½®æµ‹è¯•æ•°æ®åº“
        testDb = await setupTestDatabase();
        app = createApp({ database: testDb });
    });
    
    afterAll(async () => {
        await cleanupTestDatabase(testDb);
    });
    
    beforeEach(async () => {
        await testDb.clear();
    });
    
    describe('POST /api/users', () => {
        it('should create user and return 201', async () => {
            const userData = {
                name: 'John Doe',
                email: 'john@example.com',
                password: 'securePassword123'
            };
            
            const response = await request(app)
                .post('/api/users')
                .send(userData)
                .expect(201);
            
            expect(response.body.user.id).toBeDefined();
            expect(response.body.user.name).toBe(userData.name);
            expect(response.body.user.email).toBe(userData.email);
            expect(response.body.user.password).toBeUndefined(); // ä¸åº”è¿”å›å¯†ç 
            
            // éªŒè¯æ•°æ®åº“ä¸­çš„æ•°æ®
            const userInDb = await testDb.users.findById(response.body.user.id);
            expect(userInDb).toBeDefined();
            expect(userInDb.password).not.toBe(userData.password); // åº”è¯¥è¢«åŠ å¯†
        });
        
        it('should return 400 for duplicate email', async () => {
            const userData = {
                name: 'John Doe',
                email: 'john@example.com',
                password: 'securePassword123'
            };
            
            // å…ˆåˆ›å»ºä¸€ä¸ªç”¨æˆ·
            await request(app)
                .post('/api/users')
                .send(userData)
                .expect(201);
            
            // å°è¯•åˆ›å»ºç›¸åŒé‚®ç®±çš„ç”¨æˆ·
            const response = await request(app)
                .post('/api/users')
                .send(userData)
                .expect(400);
            
            expect(response.body.error).toContain('Email already exists');
        });
    });
});</code></pre>

                        <h3>æ•°æ®åº“é›†æˆæµ‹è¯•</h3>
                        <pre><code>// æ•°æ®åº“é›†æˆæµ‹è¯•
describe('UserRepository Integration', () => {
    let repository;
    let testDb;
    
    beforeAll(async () => {
        testDb = await createTestDatabase();
        repository = new UserRepository(testDb);
    });
    
    afterEach(async () => {
        await testDb.users.deleteMany({});
    });
    
    it('should handle concurrent user creation', async () => {
        const users = Array.from({ length: 10 }, (_, i) => ({
            name: `User ${i}`,
            email: `user${i}@example.com`,
            password: 'password123'
        }));
        
        // å¹¶å‘åˆ›å»ºç”¨æˆ·
        const promises = users.map(user => repository.create(user));
        const results = await Promise.all(promises);
        
        expect(results).toHaveLength(10);
        results.forEach((user, index) => {
            expect(user.id).toBeDefined();
            expect(user.email).toBe(users[index].email);
        });
        
        // éªŒè¯æ•°æ®åº“ä¸­çš„æ•°æ®
        const allUsers = await repository.findAll();
        expect(allUsers).toHaveLength(10);
    });
    
    it('should maintain referential integrity', async () => {
        // åˆ›å»ºç”¨æˆ·
        const user = await repository.create({
            name: 'John Doe',
            email: 'john@example.com',
            password: 'password123'
        });
        
        // åˆ›å»ºç”¨æˆ·çš„è®¢å•
        const order = await testDb.orders.create({
            userId: user.id,
            items: [{ name: 'Product 1', price: 100 }],
            total: 100
        });
        
        // å°è¯•åˆ é™¤æœ‰è®¢å•çš„ç”¨æˆ·åº”è¯¥å¤±è´¥
        await expect(repository.delete(user.id))
            .rejects.toThrow('Cannot delete user with existing orders');
        
        // å…ˆåˆ é™¤è®¢å•ï¼Œå†åˆ é™¤ç”¨æˆ·åº”è¯¥æˆåŠŸ
        await testDb.orders.delete(order.id);
        await expect(repository.delete(user.id)).resolves.toBeTruthy();
    });
});</code></pre>
                    </section>

                    <section class="tutorial-section">
                        <h2>ç«¯åˆ°ç«¯æµ‹è¯•</h2>
                        <h3>Playwright E2Eæµ‹è¯•</h3>
                        <pre><code>// E2Eæµ‹è¯•ç¤ºä¾‹
import { test, expect } from '@playwright/test';

test.describe('User Registration Flow', () => {
    test('should complete user registration successfully', async ({ page }) => {
        // è®¿é—®æ³¨å†Œé¡µé¢
        await page.goto('/register');
        
        // å¡«å†™æ³¨å†Œè¡¨å•
        await page.fill('[data-testid="name-input"]', 'John Doe');
        await page.fill('[data-testid="email-input"]', 'john@example.com');
        await page.fill('[data-testid="password-input"]', 'securePassword123');
        await page.fill('[data-testid="confirm-password-input"]', 'securePassword123');
        
        // æäº¤è¡¨å•
        await page.click('[data-testid="register-button"]');
        
        // éªŒè¯æˆåŠŸæ¶ˆæ¯
        await expect(page.locator('[data-testid="success-message"]'))
            .toContainText('Registration successful');
        
        // éªŒè¯é‡å®šå‘åˆ°ç™»å½•é¡µé¢
        await expect(page).toHaveURL('/login');
        
        // éªŒè¯å¯ä»¥ä½¿ç”¨æ–°è´¦æˆ·ç™»å½•
        await page.fill('[data-testid="email-input"]', 'john@example.com');
        await page.fill('[data-testid="password-input"]', 'securePassword123');
        await page.click('[data-testid="login-button"]');
        
        // éªŒè¯ç™»å½•æˆåŠŸ
        await expect(page).toHaveURL('/dashboard');
        await expect(page.locator('[data-testid="user-name"]'))
            .toContainText('John Doe');
    });
    
    test('should show validation errors for invalid input', async ({ page }) => {
        await page.goto('/register');
        
        // æäº¤ç©ºè¡¨å•
        await page.click('[data-testid="register-button"]');
        
        // éªŒè¯é”™è¯¯æ¶ˆæ¯
        await expect(page.locator('[data-testid="name-error"]'))
            .toContainText('Name is required');
        await expect(page.locator('[data-testid="email-error"]'))
            .toContainText('Email is required');
        await expect(page.locator('[data-testid="password-error"]'))
            .toContainText('Password is required');
        
        // å¡«å†™æ— æ•ˆé‚®ç®±
        await page.fill('[data-testid="email-input"]', 'invalid-email');
        await page.click('[data-testid="register-button"]');
        
        await expect(page.locator('[data-testid="email-error"]'))
            .toContainText('Please enter a valid email');
    });
});</code></pre>

                        <h3>æ€§èƒ½æµ‹è¯•</h3>
                        <pre><code>// æ€§èƒ½æµ‹è¯•
import { test, expect } from '@playwright/test';

test.describe('Performance Tests', () => {
    test('should load dashboard within performance budget', async ({ page }) => {
        // å¼€å§‹æ€§èƒ½ç›‘æ§
        await page.goto('/dashboard');
        
        // ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½
        await page.waitForLoadState('networkidle');
        
        // è·å–æ€§èƒ½æŒ‡æ ‡
        const performanceMetrics = await page.evaluate(() => {
            const navigation = performance.getEntriesByType('navigation')[0];
            return {
                domContentLoaded: navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart,
                loadComplete: navigation.loadEventEnd - navigation.loadEventStart,
                firstPaint: performance.getEntriesByName('first-paint')[0]?.startTime,
                firstContentfulPaint: performance.getEntriesByName('first-contentful-paint')[0]?.startTime
            };
        });
        
        // éªŒè¯æ€§èƒ½æŒ‡æ ‡
        expect(performanceMetrics.domContentLoaded).toBeLessThan(2000); // 2ç§’å†…
        expect(performanceMetrics.loadComplete).toBeLessThan(3000); // 3ç§’å†…
        expect(performanceMetrics.firstContentfulPaint).toBeLessThan(1500); // 1.5ç§’å†…
    });
    
    test('should handle concurrent users', async ({ browser }) => {
        const contexts = await Promise.all(
            Array.from({ length: 10 }, () => browser.newContext())
        );
        
        const pages = await Promise.all(
            contexts.map(context => context.newPage())
        );
        
        // å¹¶å‘è®¿é—®
        const startTime = Date.now();
        await Promise.all(
            pages.map(page => page.goto('/dashboard'))
        );
        const endTime = Date.now();
        
        // éªŒè¯æ‰€æœ‰é¡µé¢éƒ½æˆåŠŸåŠ è½½
        for (const page of pages) {
            await expect(page.locator('[data-testid="dashboard-title"]'))
                .toBeVisible();
        }
        
        // éªŒè¯å“åº”æ—¶é—´
        const totalTime = endTime - startTime;
        expect(totalTime).toBeLessThan(5000); // 5ç§’å†…å®Œæˆæ‰€æœ‰è¯·æ±‚
        
        // æ¸…ç†
        await Promise.all(contexts.map(context => context.close()));
    });
});</code></pre>
                    </section>

                    <section class="tutorial-section">
                        <h2>æµ‹è¯•è‡ªåŠ¨åŒ–ä¸CI/CD</h2>
                        <h3>GitHub Actionsé…ç½®</h3>
                        <pre><code># .github/workflows/test.yml
name: Test Suite

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run unit tests
        run: npm run test:unit -- --coverage
      
      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info

  integration-tests:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:14
        env:
          POSTGRES_PASSWORD: postgres
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run integration tests
        run: npm run test:integration
        env:
          DATABASE_URL: postgresql://postgres:postgres@localhost:5432/test

  e2e-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Install Playwright
        run: npx playwright install --with-deps
      
      - name: Start application
        run: |
          npm run build
          npm run start &
          npx wait-on http://localhost:3000
      
      - name: Run E2E tests
        run: npm run test:e2e
      
      - name: Upload test results
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: playwright-report
          path: playwright-report/</code></pre>
                    </section>

                    <section class="tutorial-section">
                        <h2>æµ‹è¯•æœ€ä½³å®è·µæ€»ç»“</h2>
                        <div class="key-takeaways">
                            <h4>æµ‹è¯•ç­–ç•¥è¦ç‚¹ï¼š</h4>
                            <ul>
                                <li>âœ… éµå¾ªæµ‹è¯•é‡‘å­—å¡”åŸåˆ™ï¼Œé‡ç‚¹å…³æ³¨å•å…ƒæµ‹è¯•</li>
                                <li>âœ… ä½¿ç”¨TDDæ–¹æ³•ï¼Œå…ˆå†™æµ‹è¯•å†å†™ä»£ç </li>
                                <li>âœ… ä¿æŒæµ‹è¯•ç‹¬ç«‹æ€§ï¼Œé¿å…æµ‹è¯•é—´ç›¸äº’ä¾èµ–</li>
                                <li>âœ… ä½¿ç”¨æœ‰æ„ä¹‰çš„æµ‹è¯•åç§°å’Œæè¿°</li>
                                <li>âœ… å®šæœŸé‡æ„æµ‹è¯•ä»£ç ï¼Œä¿æŒå¯ç»´æŠ¤æ€§</li>
                                <li>âœ… é›†æˆCI/CDæµç¨‹ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œ</li>
                            </ul>
                        </div>

                        <div class="alert alert-success">
                            <strong>ç›®æ ‡æŒ‡æ ‡ï¼š</strong>ä»£ç è¦†ç›–ç‡ > 80%ï¼Œæµ‹è¯•æ‰§è¡Œæ—¶é—´ < 10åˆ†é’Ÿï¼ŒE2Eæµ‹è¯•é€šè¿‡ç‡> 95%
                        </div>
                    </section>
                </div>

                <footer class="tutorial-footer">
                    <div class="tutorial-navigation">
                        <a href="claude-code-performance.html" class="nav-link prev">
                            â† ä¸Šä¸€ç¯‡ï¼šClaude Codeæ€§èƒ½ä¼˜åŒ–
                        </a>
                        <a href="claude-code-deployment.html" class="nav-link next">
                            ä¸‹ä¸€ç¯‡ï¼šClaude Codeéƒ¨ç½²æŒ‡å— â†’
                        </a>
                    </div>

                    <div class="tutorial-tags">
                        <span class="tag">æµ‹è¯•</span>
                        <span class="tag">TDD</span>
                        <span class="tag">è‡ªåŠ¨åŒ–</span>
                        <span class="tag">è´¨é‡ä¿è¯</span>
                    </div>
                </footer>
            </article>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <img src="../assets/logo-simple.svg" alt="Claude Code Club" class="footer-logo-img">
                        <span>Claude Code Club</span>
                    </div>
                    <p>æ¢ç´¢AIç¼–ç¨‹çš„æ— é™å¯èƒ½</p>
                </div>

                <div class="footer-section">
                    <h4>å¿«é€Ÿé“¾æ¥</h4>
                    <ul>
                        <li><a href="../tutorials/claude-basics.html">åŸºç¡€æ•™ç¨‹</a></li>
                        <li><a href="../examples/python-data-analysis.html">ä»£ç ç¤ºä¾‹</a></li>
                        <li><a href="../community.html">åŠ å…¥ç¤¾åŒº</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h4>å‹æƒ…é“¾æ¥</h4>
                    <ul>
                        <li><a href="https://claude.ai" target="_blank">Claudeå®˜ç½‘</a></li>
                        <li><a href="https://github.com/anthropics" target="_blank">Anthropic GitHub</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2024 Claude Code Club. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚</p>
            </div>
        </div>
    </footer>

    <script src="../scripts/main.js"></script>
    <script src="../scripts/wechat-share.js"></script>
</body>

</html>